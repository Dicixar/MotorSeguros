<!DOCTYPE html>
<html>

<head>
    <title>MotorSeguros</title>
    <link rel="stylesheet" href="Styles/loginStyle.css">
    <link rel="stylesheet" href="Styles/mainStyle.css">
</head>

<body class="body_login">
    <nav>
        <div class="menu">
            <div class="logo">
                <a href="index.html">
                    <img src="Logo/2.png">
                </a>
            </div>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="Seguros.html">Simulador</a></li>
                <li><a href="Promo.html">Promoções</a></li>
                <li><a href="Contactos.html">Contacto</a></li>
                <li><a href="Login.html">Login</a></li>
            </ul>
        </div>
    </nav>
    </section>
    <div class="main-login">
        <h3>Introduza os seus dados</h3>
        <form action="">

            <label class="lblog" for="first">Email:</label>
            <input class="inputlog" type="text" id="email" name="first" placeholder="Introduza o Email" required>

            <label class="lblog" for="password">Password:</label>
            <input type="password" class="inputlog" id="password" name="password" placeholder="Introduza a Password"
                required>

            <div class="wrap">
                <button type="submit" id="login" class="btnlog" onclick="Entrar()">Login</button>
            </div>
        </form>
        <span class="form__span" id="status"></span>
    </div>
    <script>
        const emailInput = document.getElementById('email'),
            nameInput = document.getElementById('nome'),
            passInput = document.getElementById('password'),
            loginBtn = document.getElementById('login'),
            signupBtn = document.getElementById('signup'),
            statusSpan = document.getElementById('status')

        loginBtn.addEventListener('click', (e) => {
            e.preventDefault()

            Entrar(emailInput.value, passInput.value)
        })

        async function Entrar(emailForm, passForm) {
            const users = await getData('./dados.json')

            users.forEach(user => {
                if (emailForm == user.email && passForm == user.password) {
                    console.log('Login Realizado')
                    localStorage.setItem('user', JSON.stringify({ name: user.name, email: user.email, role: user.role }));
                    if (user.name == 'admin') {
                        window.location.replace('LoginAdmin.html')
                    }
                    else
                        window.location.replace('LoginUser.html')
                } else {
                    statusSpan.textContent = 'Email ou Senha incorretos'
                }
            });
        }

        async function getData(src) {
            const response = await fetch(src)
            const responseJson = await response.json()
            return responseJson
        }

    </script>
</body>

</html>